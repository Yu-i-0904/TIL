# 書籍名
Everyday Rails - RSpecによるRailsテスト入門

# 目的
* RSpecの基本的な使い方と信頼性の高いテストの書き方を学ぶ

# 目次
## 1章 イントロダクション
## 2章 Rspecのセットアップ
## 3章 モデルスペック
## 4章 意味のあるテストデータの作成
## 5章 コントローラスペック
## 6章 システムスペックでUIをテストする
## 7章 リクエストスペックでAPIをテストする
## 8章 スペックをDRYに保つ
## 9章 速くテストを書き、早いテストを書く
## 10章 その他のテスト
## 11章 テスト駆動開発に向けて
## 12章 最後のアドバイス

# 1章 イントロダクション
* テストを書く際の基本的な新城
  * テストは信頼できるものであること
  * テストは簡単に書けること
  * テストは簡単に理解できること（今日も将来も）

# 2章 Rspecのセットアップ
* RspecはデフォルトではRailsに含まれていないため、Bundlerを使ってインストールする必要がある
* rspec-railsはrspec-coreとその他の独立したgemが含まれている。
* Rails以外のアプリケーションでRspecを使いたい場合は、個別にインストールする必要がある
* `rails generate rspec: install`コマンドを実行すると、RSpec用の設定ファイルと、作成したスペックファイルを格納するspecディレクトリ、RSpecの動きをカスタマイズするヘルパーファイルが作成される
* RSpecの出力形式を変更する
  * .specファイルに下記の修正を加えることで、デフォルトの出力形式からドキュメント形式に変更することができる
  * `--require spec_ helper`
  * `--format documentation`
  * ドキュメント形式に変更することでどのスペックがパスし、どのスペックが失敗したかわかりやすくなり、スペックのアウトラインが綺麗に出力される
  * この出力を仕様書のように使うこともできる

# 3章 モデルスペック
* モデルスペックのテストには下記を含める
  * 有効な属性で初期化された場合は、モデルの状態が有効（valid）になっていること
  * バリデーションを失敗させるデータであれば、モデルの状態が有効になっていること
  * クラスメソッドとインスタンスメソッドが期待通りに動作すること
* ベストプラクティス
  * 期待する結果をまとめて記述（describe）する
    * 該当のモデルがどんなモデルか、どんな振る舞いをするのかを説明する
  * example（itで始まる1行）一つにつき、結果を一つだけ期待する
    * 一つだけにすることでexampleが失敗した時に問題が発生した箇所を特定できる
  * exampleを明示的にする
    * itの後に続く説明用の文字列は必須ではないが省略すると読みにくくなるので省略しない
  * 各exampleの説明は動詞で始まっていること。shouldではない
    * 可読性はRSpecのキーとなる機能
* モデルスペックの作成
  * describeでどのモデルのテストを書くか示す
* RSpecの構文
  * `expect`メソッドを使用して期待した通りのなるかならないかを検証する
* バリデーションをテストする
  * 作成したモデルに対し`valid?`メソッドを呼び出し、エラーメッセージが該当の属性についていることを期待（expect）する
  * `include`というマッチャを使用してある値が存在するかを確認する
  * テストコードが意図した通りに動いているか確認するため
    * `to`を`to_not`に換えてテストが失敗することを確認する
    * アプリケーション側のコードを変更して、テストの実行結果にどんな変化があるか確認する
    * 上記を試してテストの実行結果に変化がない時は、テストコードが間違っている