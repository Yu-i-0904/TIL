# 書籍名
パーフェクトRuby on Rails

# 目的
* Rails開発の一連の流れの把握とと基礎知識の習得

# 目次
## 1章　Ruby on Railsの概要
* 1-1　Railsを使う前に
* 1-2　Railsの思想
* 1-3　Railsをはじめよう!!
* 1-4　scaffoldを使ってRailsでの開発を体験しよう

## 2章　Ruby on RailsとMVC
* 2-1　MVCアーキテクチャ
* 2-2　モデルを扱う
* 2-3　コントローラの役割
* 2-4　コントローラとビューの協調とビューテンプレートの基本
* 2-5　ビューテンプレートについて

## 3章　押さえておきたいRailsの基本機能
* 3-1　テストの種類と実行方法
* 3-2　RackとRailsの関係
* 3-3　DBを管理する
* 3-4　秘密情報を管理する
* 3-5　HTTPとRailsアプリケーション

## 4章　フロントエンドの開発手法
* 4-1　Webpackerを使ってJavaScriptを管理する
* 4-2　SprocketsによるCSSの管理
* 4-3　Railsに組み込まれているJavaScriptの機能
* 4-4　控えめなJavaScriptフレームワークStimulus

## 5章　Rails標準の機能を活用して素早く機能実装する
* 5-1　Active Jobによる非同期実行
* 5-2　Active Storageによるファイルアップロード
* 5-3　Action Mailerによるメール送信
* 5-4　Action Mailboxによるメール受信
* 5-5　Action Textによるリッチテキスト機能
* 5-6　Action Cableによるリアルタイム通信

## 6章　Railsアプリケーション開発
* 6-1　イベント告知アプリケーションを作る
* 6-2　アプリケーションの作成と下準備
* 6-3　OAuthを利用して「GitHubでログイン」機能を作る
* 6-4　イベントの登録機能を作る
* 6-5　イベントの閲覧機能を作る
* 6-6　イベントの編集・削除機能を作る
* 6-7　登録されたイベントへの参加機能，参加キャンセル機能を作る
* 6-8　退会機能を作る
* 6-9　おわりに

## 7章　Railsアプリケーションのテスト
* 7-1　テストコードをどう書いていくか
* 7-2　minitestとRSpec
* 7-3　テストデータを作成する
* 7-4　システムテスト
* 7-5　コントローラに対する機能テスト
* 7-6　モデルに対するテスト

## 8章　Railsアプリケーション拡張
* 8-1　ファイルアップロード機能を作る
* 8-2　gemで機能拡張をする
* 8-3　落穂ひろい

## 9章　コード品質を上げる
* 9-1　CI（継続的インテグレーション）
* 9-2　Gemの定期update
* 9-3　静的解析
* 9-4　カバレッジ測定
* 9-5　アプリケーションパフォーマンス測定（APM）

## 10章　コンテナを利用したRailsアプリケーションの運用
* 10-1　Railsアプリケーションのインフラ概要
* 10-2　基本的なDockerイメージの構築
* 10-3　開発環境におけるDockerの活用
* 10-4　環境によって可変する設定値や秘匿情報の管理
* 10-5　ログ出力
* 10-6　HTTPサーバとの通信

## 11章　複雑なドメインを表現する
* 11-1　アーキテクチャパターンから見るRails
* 11-2　値オブジェクト
* 11-3　サービスオブジェクト

## 12章　複雑なユースケースを実現する
* 12-1　ユースケースとモデル
* 12-2　データベースと紐づかないモデルを作る
* 12-3　フォームオブジェクト
* 12-4　プレゼンター

## 13章　複雑なデータ操作を実装する
* 13-1　Concern
* 13-2　コールバックオブジェクト

# 1章　Ruby on Railsの概要
# 2章　Ruby on RailsとMVC
# 3章　押さえておきたいRailsの基本機能
# 4章　フロントエンドの開発手法
# 5章　Rails標準の機能を活用して素早く機能実装する
## 5-1　Active Jobによる非同期実行
* Active Jobを利用することでバックエンド上で実行する非同期処理を統一的に利用できる
* ジョブクラス内の`perform`メソッドにジョブで実行したい処理を記述する
* アダプターはデフォルトでasyncが設定されている（プロセスを再起動するとキューの中のジョブは失われるため、本番利用は避ける）
* `perform_later`メソッドはバックエンドキューにジョブを追加して非同期実行する
* 引数として下記を渡すことができる
  * 基本型
  * シンボル
  * 日時を扱う方
  * ハッシュ
  * 配列
  * Active Recordオブジェクト
* 本番環境のアダプターはSidekiq、Resque、Delayed Jobなどが用意されている
* 複数のキューを管理する際は、`queue_as`メソッドを使用することでキューを指定できる
* キューを指定する他の方法で、`set`メソッドを使いqueue引数へキュー名を渡すこともできる
* ジョブのリトライのための`retry_on`と破棄するための`discard_on`が用意されている
  * `attempts`オプションはリトライ回数を指定できる
  * `discard_on`はオプションはなく、キャッチしたい例外クラス（複数可）を指定できる
  * 両メソッドとも引数にブロックを渡すことができるので、ブロック内で処理を書くことができる

## 5-3　Action Mailerによるメール送信
* メイラー、ビュー、設定を規則に沿って実装することができる
* ApplicationMailerを継承し、実装する
* `UserMailer.with(to:, name:).定義したメソッド.deliver_now`で呼び出す
* `with`メソッドの引数で渡した値は、呼び出し先で`params`として使用できる
* @nameなどインスタンス変数としてcontroller同様、ビューに値を渡すことができる
* `mail`メソッドを呼び出すとHTMLとテキストの2種類のテンプレートを探し、multipart/alternative形式のメールを作成する
* `deliver_now`は同期的にメールを送信するメソッド
* `deliver_later`は非同期でメールを送信するメソッド
  * `deliver_later`はActive Jobを使用しているので、キューの永続化など注意が必要
* Action MailerのテストはActionMailer::TestCaseクラスを継承し作成する

# 6章　Railsアプリケーション開発
## 6-7　登録されたイベントへの参加機能，参加キャンセル機能を作る
* どんな時にヘルパーを使うか
  * viewにビジネスロジックを書くと読みづらくなる時
  * グローバル関数のように振る舞うため、数が多くなってくると見通しが悪くなる
  * またヘルパーメソッドの書き方がオブジェクト指向的でない
  * 解決策としてDraperやActiveDecoratorなどのプレゼンター用のgemを利用し、モデルと紐づいた形でview用のロジックを書く
* N+1問題の察知
  * bulletというgemを使うことで、自動でN+1を検知してログ出力やJavaScriptのアラートを出してくれる

# 7章　Railsアプリケーションのテスト
## 7-1　テストコードをどう書いていくか
* TDD（テスト駆動開発）
  * テストを最初に書く（どのような設計にするか）
  * テストを書いた後は、どうやったらテストをパスするかを考え実装する
  * テストをパスするようになったら、どう修正したら綺麗なコードになるか考えリファクタリングする
  * それぞれの段階で、設計、実装、リファクタリングをするだけで良いので、考えることを減らせる
* ブラウザから操作するアプリケーションの場合、E2Eテスト（システムテスト）から書き始めるのが良い
  * 外から見たアプリケーションの動作がわかればテストを書けるので、概要を掴んだ段階でテストを書ける
  * routes、コントローラー、モデル、ビューの全てを通るので、テストカバレッジを広げることができる
  * テストを書いてアプリケーションの使用を確かめることができるので、理解が深まる

## 7-2　minitestとRSpec
* minitest
  * Railsはデフォルトでminitestを利用するようになっている
  * XUnit風とRSpec風の2つの書き方をサポートしている
  * Active Job、Actionn Mailerなどの各機能のテストをするのに便利なヘルパーなど提供されている
* RSpec
  * Railsアプリ開発に利用するテストフレームワークのデフォルトスタンダードといえるライブラリ

# 8章　Railsアプリケーション拡張
## 8-1　ファイルアップロード機能を作る
* Active Storage