# 書籍名
理論から学ぶデータベース実践入門

# 目的
* 基本的なSQLの書き方を学ぶ
* パフォーマンスが高く、保守しやすいDB設計を学ぶ

# 目次
## 1章 SQLとリレーショナルモデル
## 2章 述語論理とリレーショナルモデル
## 3章 正規化理論（その１）―関数従属性
## 4章 正規化理論（その２）―結合従属性
## 5章 リレーションの直交性
## 6章 ドメインの設計戦略
## 7章 NULLとの戦い
## 8章 SELECTを攻略する
## 9章 履歴データとうまく付き合う
## 10章 グラフに立ち向かう
## 11章 インデックスの設計戦略
## 12章 Webアプリケーションのためのデータ構造
## 13章 リファクタリングの最適解
## 14章 トランザクションの本質

# 1章 SQLとリレーショナルモデル
## 1.1 そもそもSQLって？
* SQLはリレーショナルデータベースに対して問い合わせを行う言語
* リレーショナルモデルをベースにしているが忠実には再現していない
* リレーショナルモデルに沿った使い方も出来れば、大きく逸脱した使い方もできる

## 1.2 リレーショナルモデル
* 現実世界のデータを「リレーション」と呼ばれる概念を用いて表現するデータモデル
* リレーショナルモデルが表すデータモデルは設計という意味ではなく、データをどのように表現するかという概念
* リレーショナルモデルを理解する上で、最も重要な概念が**リレーション**
* SQLにおいてリレーションに相当するものは**テーブル**
* リレーション
  * 見出し（Heading）と本体（Body）で構成される
  * 見出しはn個の属性の集合。属性は名前とデータ型のペアとなっている
  * 本体は属性値の集合である組、あるいはタプル（tuple）の集合。タプルに含まれる属性値は名称とデータ型が見出しで指定したものと一致していること
  * リレーショナルモデルは、集合論に根ざしたデータモデル
* リレーションの演算
  * 制限（Restrict）
    * あるリレーションのうち、特定の条件にあうタプルだけを含んだリレーションを返す
    * 制限を実行した結果は元のリレーションの部分集合と言える
  * 射影（Projection）
    * あるリレーションにおいて、特定の属性だけを含んだリレーションを返す
    * 属性が少なくなると、タプルに重複が生まれ同一のものとして扱われる
  * 拡張（Extend）
    * 射影と反対に属性を増やす操作
    * 多くの場合は新しい属性の値は、既存の属性の鯛を使って算出される
  * 属性名変更（Rename）
    * 属性の名前を変更する
    * 主に拡張した属性に対して名称を与える場合に利用される
  * 和（Union）
    * 2つのリレーションに含まれる、全てのタプルで構成されるリレーション（和集合）を返す
    * 2つのリレーションに共通の属性値が含まれる場合、生成される和集合では重複が解消された状態になる
  * 積/交わり（Intersect）
    * 2つのリレーションの交わり（共通部分）になっているリレーションを返す
  * 差（Difference）
    * 2つのリレーションのうち、片方のリレーションにのみに含まれるタプルで構成されるリレーション
    * どちらのリレーションからどちらのリレーションを引くかで結果が変わる
  * 直積（Product）
    * ある2つのリレーションのタプルをそれぞれ組み合わせたリレーションを返す
    * 生成されたリレーションの見出しには、2つのリレーションの見出しが持つ属性がすべて含まれる
  * 結合（Join）
    * 共通の属性を持つ2つのリレーションをその共通の属性の値が同じタプルを同士を組み合わせたリレーションを返す
    * 結果として残るタプルは、2るのリレーションで共通の属性において、同じ値が存在するものだけ
    * SQLにおいて、内部結合と外部結合にあたる
    * リレーショナルモデルに存在するのは、内部結合のみ
* クロージャ・プロパティ（閉包性）
  * リレーショナルモデルで大切なことは、リレーションを用いた演算結果がリレーションになること
  * 演算の入力も出力も同じデータ構造を持ったものになる性質をクロージャ―（閉包）といい、その性質をクロージャ―・プロパティ（閉包性）という
  * 入出力で同じデータ構造を持つことは重要。演算結果を新たな入力をし、数珠つなぎのように演算を記述することで複雑な演算を表現できる
  * リレーションの演算だけを用いて、複雑な演算を表現できる点がリレーショナルモデルの真骨頂

## 1.3 SQLにおけるリレーション操作
* SELECTの基本形
  * データを参照するために利用できる唯一のコマンド
  * SELECTは論理的には直積、制限、射影の3つリレーションを同時に行う操作と言える（下記は評価の順番）
    * テーブルのリスト（直積）
    * 検索条件（制限）
    * カラムのリスト（射影）
* INSERT（挿入）
  * リレーションをそのリレーションに対して新しくINSERTするタプル（≒行）を追加したリレーションと置き換えるという操作
* DELETE（削除）
  * 元のリレーションを条件と一致しないタプルからなるリレーションに置き換える
* UPDATE（更新）
  * 元のリレーションから条件に一致するタプルからなるリレーションの差集合を取る
  * 上記に対して、差を取ったリレーションに修正を加えたリレーションとの和集合を導く
  * 上記の和集合を代入する
## 1.4 SQLにあってリレーショナルモデルにないもの
* 要素の重複
  * 集合は重複が存在しないが、テーブルは存在する
  * テーブルは多重集合といえ、集合と多重集合では性質が異なる
* 要素間の順序
  * 集合に要素の順序は存在しない
  * SQLには順序が存在する
  * SQLをリレーショナルモデルに沿って使うには、行やカラムの位置を意識したクエリを発行するべきではない
* リレーションの更新
  * リレーションは値であるため更新ができない
  * テーブルが値と変数の両方の機能を兼ねているため更新が可能となっている

# 2章 述語論理とリレーショナルモデル

# 3章 正規化理論（その１）―関数従属性
## 3.2 正規化
* リレーショナルモデルを補完する理論
  * 正規化理論はRDBを使いこなすために必要なテクニックであり、リレーショナルモデルを前提として構築されたDB設計理論
  * リレーショナルモデルの上に立脚し、リレーショナルモデルを補完する理論ともいえる
* 異常を防ぐことができる
  * 最も重要なのは、矛盾を防ぐことができること
  * リレーショナルモデルの異常はを起こす原因は**重複**
  * **重複**があると些細な更新のミスで矛盾が生じる
  * 矛盾が発生しないようにするには**重複**を排除すればよい

## 3.3 正規形
* 正規化にはいくつか段階があり、より高い段階へ進んだ方がより良い状態になる。正規化における各々の段階を正規形（Norml Form）と呼ぶ
* 第1正規形（1NF）
  * 1NFになる条件はリレーションであること
  * これはリレーショナルモデルではなく、SQLに摘要される条件である
  * テーブルが1NFになるため要件とは下記である
    * 行が上から下に順序付けされていない
    * 列が左から右に順序付けされていない
    * 重複する行は存在しない
    * それぞれの行と列の交差点（つまり列の値）は、ドメイン（データ型）に属する要素の値をちょうど1つだけ含んでいる
    * 全ての列の値は定義されたものだけであり、かつそれぞれの行において常に存在する
  * カラムや行の順序
    * SQLの仕様としてテーブル内のカラムに順序が存在するが、カラムや行の位置に依存しないクエリを発行すれば問題にならない
  * 重複する行をなくす
    * 主キーやユニークキーといった一意性を制約をつければ良い（よくある誤解で行が重複していなければそれで正規化はできていると思われる）
    * 行全体がすべて異なる値でもデータに重複が生じることがある
  * NULLが含まれてはいけない
    * NULLが含まれているとリレーショナルモデルが破綻するため、全ての行、カラムには具体的な値が入っていないといけない
    * テーブルを分割し、NULLが入るのを防ぐ
    * アプリケーションは処理の内容に応じて必要なデータを格納するので、カラムの値がNULLであるということはアプリケーションがまだデータを必要としていないということ
  * 値のアトミック性
    * 値はより細かい単位に分割されることなく、全体のアプリケーションにとって意味のあるものでなければ、属性の値としてはいけない
    * ドメインとは属性の取り得る値の集合。集合の要素はそれ以上分解できないからアトミックである
    * つまり、意味のあるデータとは**ドメインの要素の一つである**
  * 繰り返しグループ
    * 典型的な例は、1つの列（ないしは属性）に複数の値をカンマ区切りなどの形式で割り当てるなど
    * 上記のデータ形式では、中の値を分解して演算を行う必要が生じるため、リレーショナルモデルに基づいたロジックを組立られない
    * クエリが複雑になり、データの整合性は危機に瀕し、アプリケーションで実装しなければいけないロジックが膨れ上がる
  * 候補キーとスーパーキー
    * 候補キーとは、そのリレーションに含まれるタプルの値を一意に決められる属性の集合で、なおかつ既約であるものをいう
    * 候補キーは余分な属性を含まない属性の集合であるが、候補キーのスーパーセット（余分な属性を含むもの）をスーパーキーという
    * スーパーキーは一意な値を求めるのに貢献しない属性が含まれているというだけ
    * 候補キーはスーパーキーの一種であり、含まれ属性の数が最小のものである
    * リレーションには重複したタプルが含まれないため、最低でも1つの候補キーが存在する